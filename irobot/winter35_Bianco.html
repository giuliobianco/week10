<!DOCTYPE html>
<html>
    <head>
        <title>Day 35</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">
        <link href="http://saasmath.seattleacademy.org/css/bootstrap.css" rel="stylesheet">
    <script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/0.9.16/socket.io.min.js"></script>
    <script src="https://code.jquery.com/jquery-2.2.0.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>

        <script>
                var tempo = 2000;
    mysong = [
        [261, tempo * .125],
        [261, tempo * .125],
        [261, tempo * .125],
        [698, tempo * .25],
        [880, tempo * .25],
        [null, 50],
        [261, tempo * .125],
        [261, tempo * .125],
        [261, tempo * .125],
        [698, tempo * .25],
        [880, tempo * .25],
        [null, 200],
        [698, tempo * .125],
        [698, tempo * .125],
        [659, tempo * .125],
        [659, tempo * .125],
        [587, tempo * .125],
        [587, tempo * .125],
        [523, 450]
    ];

            $(document).ready(function() {
                var socket = io('/');
                $("#turnOneSec").click(function(e) {
                    console.log("turn90");
                    speed = $("#speed").text();
                    if (speed < 10) {
                        speed = 50;
                        $("#speed").text(50);
                    }
                    socket.emit('drive', {left: speed, right: -speed});
                    setTimeout(function() {
                        socket.emit('drive', {left: speed, right: speed});
                    }, 1000)
                });
                function followline(data) {
                    speed = $("#speed").text();
                    if (speed < 10)
                        return;
                    front_left = data.cliff_sensors.front_left.signal.raw;
                    front_right = data.cliff_sensors.front_right.signal.raw;
                    if (Math.abs(front_left - front_right) < 100) {
                        socket.emit('drive', {left: speed, right: speed});
                        return;
                    }
                    ;
                    if (Math.abs(front_left < front_right)) {
                        socket.emit('drive', {left: speed * .5, right: speed});
                    }
                    ;
                    if (Math.abs(front_left > front_right)) {
                        socket.emit('drive', {left: speed, right: speed * .5});
                    }
                    ;
                }
                socket.on('sensordata', function(data) {
                    //console.log(data);
                    $("#voltage").text(data.battery.voltage.volts);
                    $("#left").text(data.cliff_sensors.left.signal.raw);
                    $("#front_left").text(data.cliff_sensors.front_left.signal.raw);
                    $("#front_right").text(data.cliff_sensors.front_right.signal.raw);
                    $("#right").text(data.cliff_sensors.right.signal.raw);
                    //$("#allsensors").text(JSON.stringify(data));
                    if ($('#followline').is(':checked')) {
                        followline(data)
                    }
                    ;
                    socket.emit('sensorswritten');
                });
                $("#forward").click(function(e) {
                    console.log('forward');
                    socket.emit('drive', {left: 15, right: 15});
                });
                $("#halt").click(function(e) {
                    console.log('halt');
                    socket.emit('drive', {left: 0, right: 0});
                });
                $("#giulio").click(function(e) {
                    socket.emit('sing', mysong);
                });
                $("#safeMode").click(function(e) {
                    socket.emit('safeMode');
                });
                $("#fullMode").click(function(e) {
                    socket.emit('fullMode');
                });
                $('body').keydown(function(event) {
                    console.log(event.which);
                    speed = $("#speed").text();
                    //speed = 100;
                    if (event.which === 87) //w - move forward
                    {
                        speed = $("#speed").text();
                        speed = speed * 1 + 50;
                        $("#speed").text(speed);
                        socket.emit('drive', {left: speed, right: speed});
                    }
                    if (event.which === 83) //s - move backward
                    {
                        speed = $("#speed").text();
                        speed = speed * 1 - 50;
                        $("#speed").text(speed);
                        socket.emit('drive', {left: speed, right: speed});
                    }
                    if (event.which === 65) //d - move right
                    {
                        speed = $("#speed").text();
                        speed = 50;
                        $("#speed").text(speed);
                        socket.emit('drive', {left: speed, right: -speed});
                    }
                    if (event.which === 68) //a - move left
                    {
                        speed = $("#speed").text();
                        speed = 50;
                        $("#speed").text(speed);
                        socket.emit('drive', {left: -speed, right: speed});
                    }
                    if (event.which === 51) { //3 on keyboard, play note
                        note3 = [[659.3, 100]];
                        socket.emit('sing', note3);
                    }
                    ;
                    if (event.which === 50) { //2 on keyboard, play note
                        note3 = [[587.3, 100]];
                        socket.emit('sing', note3);
                    }
                    ;
                    if (event.which === 49) { //1 on keyboard, play note
                        note3 = [[523.3, 100]];
                        socket.emit('sing', note3);
                    }
                    ;
                    if (event.which === 53) { //4 on keyboard, play note
                            note3 = [[698.5, 100]];
                            socket.emit('sing', note3);
                        }
                        ;
                        if (event.which === 54) { //5 on keyboard, play note
                            note3 = [[784.0, 100]];
                            socket.emit('sing', note3);
                        }
                        ;
                        if (event.which === 55) { //6 on keyboard, play note
                            note3 = [[300, 100]];
                            socket.emit('sing', note3);
                        }
                        ;
                    if (event.which === 32) //space - stop
                    {
                        speed = $("#speed").text();
                        speed = 0;
                        $("#speed").text(speed);
                        socket.emit('drive', {left: speed, right: speed});
                        event.preventDefault();
                    }
                });
            });
        </script>

    </head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-xs-3 left_signal darkness">
                left
            </div>
            <div class="col-xs-3 front_left_signal darkness">
                front_left
            </div>
            <div class="col-xs-3 front_right_signal darkness">
                front_right
            </div>
            <div class="col-xs-3 left_signal darkness">
                right
            </div>


        </div>
        <div class="row">
            <div class="col-xs-3 sensor-block col-xs-offset-1">
                <div class="sensor-title">Voltage</div>
                <div class="sensor-value" id="voltage">...</div>
            </div>
            <div class="col-xs-3 col-xs-offset-1 sensor-block">
                <div class="sensor-title">Speed</div>
                <div class="sensor-value" id="speed">0</div>
            </div>
            <div class="col-xs-3 col-xs-offset-1 sensor-block" id="darkness">
                <div class="sensor-title">countup</div>
                <div id="countup" class="sensor-value">0</div>
            </div>
        </div>

        <div class="row">
            <div class="col-xs-3 sensor-block col-xs-offset-1">
                <div class="sensor-title">state.angle</div>
                <div class="sensor-value" id="angleccw">...</div>
            </div>
            <div class="col-xs-3 col-xs-offset-1 sensor-block">
                <div class="sensor-title">Speed</div>
                <div class="sensor-value" id="speed">0</div>
            </div>
            <div class="col-xs-3 col-xs-offset-1 sensor-block">
                <div class="sensor-title">countup</div>
                <div id="countup" class="sensor-value">0</div>
            </div>
        </div>

        <h3>Robot Control</h3>
        <div class="row">
            <button class="btn-warning btn col-xs-2" id="safeMode">Safe Mode</button>
            <button class="btn-danger btn col-xs-3" id="fullMode">Full Mode</button>
        </div>
        <div class="row">
            <div class="col-xs-3">
                <button class="btn btn-danger" id="stop">Stop
                    <span class="glyphicon glyphicon-stop"></span>
                </button>
                <button class="btn btn-primary" id="go">Go
                    <span class="glyphicon glyphicon-play"></span>
                </button>
                <button id="giulio" class="btn-success btn-lg btn-block">Play Music
                    <span class="glyphicon glyphicon-music"></span>
                </button>
                <button id="turnOneSec" class="btn-primary btn-lg btn-block">Turn For One Second
                    <span class="glyphicon glyphicon-refresh"></span>
                </button>
                <button id="dance" class="btn-primary btn-lg btn-block">Dance
                    <span class="glyphicon glyphicon-fire"></span>
                </button>
            </div>
        </div>
        <div class="row">
            <div class="col-md-2 col-md-offset-5">
                <button class="btn-primary btn-lg btn-block" id="forward">Forward<span class="glyphicon glyphicon-arrow-up"></span>
                </button>
            </div>
        </div>
        <div class="row">
            <div class="col-md-2 col-md-offset-3">
                <button class="btn-primary btn-lg btn-block" id="turnLeft">Left<span class="glyphicon glyphicon-arrow-left"></span>
                </button>
            </div>
            <div class="col-md-2 col-md-offset-2">
                <button class="btn-primary btn-lg btn-block" id="turnRight">Right<span class="glyphicon glyphicon-arrow-right"></span>
                </button>
            </div>
        </div>
        <div class="row">
            <div class="col-md-2 col-md-offset-5">
                <button class="btn-primary btn-lg btn-block" id="backward">Backward<span class="glyphicon glyphicon-arrow-down"></span>
                </button>
            </div>
            <div class="row">
                <div class="col-xs-6">
                    <div class="alert alert-info wordwrap" id="left">Sensors ...</div>
                    <div class="row">
                        <div class="col-xs-6 col-sm-offset-6">
                            <div class="alert alert-info wordwrap" id="right">Sensors ...</div>

                            <div>
                                front_left <span id="front_left">...</span> front_right <span id="front_right">...</span>
                            </div>
                            <button id="togglesensors">Toggle Sensors</button>
                            <div id="allsensors">...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="progress">
  <div class="progress-bar" role="progressbar" aria-valuenow="70"
  aria-valuemin="0" aria-valuemax="100" style="width:70%">
    70%
  </div>
</div>

</body>

</html>